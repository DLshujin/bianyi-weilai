# 课消平台

## 项目简介
课消平台是一款基于 Flask + SQLite 的现代化课时消耗与排课管理系统，支持多角色权限、自动邮件提醒、统计报表、操作日志、极简美观的响应式前端，适用于教培机构、学校等场景。

## 主要功能
- **学生、课程、用户、课消记录管理**
- **排课管理**：支持多学生、时间冲突检测、精确到分钟的上课/下课时间
- **消课管理**：支持点名消课、补充主题/备注/课时，二次确认，消课后排课状态自动变更
- **一键提醒老师**：管理员可一键邮件提醒所有“待上课”与“待消课”老师，支持QQ邮箱授权码
- **自动定时提醒**：APScheduler 每天自动邮件提醒老师上课/消课
- **统计报表**：课程、老师、学生多维度统计，消课率分析
- **操作日志**：所有增删改操作均有详细日志，便于审计
- **权限体系**：三权分立（admin/manager/user），操作范围严格区分
- **页面美化与移动端适配**：Bootstrap 5 + FontAwesome，极简现代深色风格，移动端横屏友好
- **Excel 导入导出**：支持学生、课程、课消记录的批量导入导出
- **学生与用户账号自动联动**：添加学生时自动创建普通用户账号（用户名为学生姓名，密码为手机号），删除学生时自动删除对应账号及所有相关数据
- **首页课程剩余详情**：课程剩余详情已集成在首页卡片下方，普通用户仅能看到与自己相关的课程信息，管理员/管理者可筛选全部
- **个性化欢迎语**：首页欢迎语自动显示学生姓名并居中展示

## 账号与权限说明
- 学生登录时可用姓名或手机号，系统会展示所有与登录名（姓名或手机号）完全匹配的学生信息，防止同名混乱。
- admin：最高权限，全部功能。
- 老师（teacher/manager）：可排课、添加学生，不能发邮件、配置、看操作日志。
- 学生（student/user）：只能查看与自己姓名或手机号匹配的学生信息，不能增删改。

## 邮件提醒功能
- 支持 QQ 邮箱及授权码配置
- 管理员可在首页一键提醒所有待上课/待消课老师
- APScheduler 自动定时提醒老师上课/消课
- 邮件内容美观，包含课程、学生、时间、备注等关键信息

## 视觉与交互亮点
- 全站深色主题，已移除主题切换，风格统一现代极简
- 欢迎语居中高亮，自动显示学生姓名
- 首页课程剩余详情无须跳转，信息一目了然
- 卡片、表格、按钮、表单风格统一，主色高亮
- FontAwesome 图标全覆盖，提升辨识度
- 登录页全屏背景+半透明卡片+绿色描边输入框
- 移动端横屏自适应，表格横向滚动

## 数据表结构说明
- 学生表（student）：无 email 字段，包含 id、name、contact
- 用户表（user）：email 可选，用户名唯一
- 学生-课程关联表名为 `student_course`

## 快速开始
1. 克隆项目
   ```bash
   git clone <your-repo-url>
   cd <project-folder>
   ```
2. 安装依赖
   ```bash
   pip install -r requirements.txt
   # 如无 requirements.txt，可手动安装：pip install flask pypinyin apscheduler pandas openpyxl
   ```
3. 初始化数据库
   ```bash
   python init_db.py
   ```
4. 启动服务
   ```bash
   python app.py
   # 或 flask run
   ```
5. 浏览器访问
   - 本地：`http://127.0.0.1:5000`

## 一键初始化/重置
如需清空所有业务数据并重置 admin 账号：
```bash
python clear_db.py
```
- 所有数据将被清空，仅保留 admin 账号，密码为 888888

## 文件清理与部署说明
- 已添加标准 .gitignore，自动忽略 venv、__pycache__、school.db、.idea、.vscode 等无用文件和目录。
- 建议部署时仅上传代码、模板、静态资源和 requirements.txt，不要上传 school.db、venv 等本地文件。
- 服务器请用自己的虚拟环境，并用 `python init_db.py` 初始化数据库。

## 常见问题
- **依赖未安装**：请用 pip 安装缺失的库
- **database is locked**：请关闭占用数据库的程序或重启电脑
- **路径问题**：建议项目路径全英文，避免中文或特殊字符
- **推送失败**：请先 git pull 保持同步，解决冲突后再 push
- **移动端显示异常**：请刷新浏览器缓存，或切换横屏
- **学生姓名与用户账号**：添加学生时自动创建普通用户账号，删除学生时自动删除对应账号及所有相关数据
- **主题风格**：全站仅保留深色主题，已移除主题切换

## 贡献与协作
- 推荐使用 GitHub 协作开发，推送前请先 `git pull` 保持同步
- 如遇冲突，手动解决后再 push
- 已内置测试账号，便于初始体验和测试

---
如有更多问题或建议，欢迎 issue 或联系开发者。
