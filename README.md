# 课消平台

## 项目简介
基于 Flask + SQLite 的课消管理平台，支持学生、课程、课消记录、排课管理、统计报表等，具备三权分立权限体系（admin/manager/user），并支持详细操作日志审计和现代化页面体验。

## 主要功能
- 学生、用户、课消记录管理
- 多学生同时消课（支持一节课多个学生消课）
- 排课管理（支持多学生、时间冲突检测、点名消课，支持设置开始/结束日期，精确到“年月日时分”）
- 点名消课（弹窗补充主题/备注/课时，二次确认，消课后排课状态变更）
- 课程管理（支持录入课程单价、总课时，课程选择项统一为“C++”“GOC”“图形化”“其他”，选“其他”可自定义课程名）
- 首页学生搜索与课程筛选（支持拼音首字母、课程筛选、导出Excel，展示单价、总课时、已上课时、剩余课时、消课记录等）
- 统计报表（总数、课程/老师/学生统计、消课率等）
- 权限分级与细化（admin/manager/user，操作范围严格区分）
- 操作日志增强（排课、消课、编辑、删除等均有详细日志）
- 页面美化与交互优化（斑马线表格、按钮状态、弹窗体验、移动端适配等）
- 排课管理入口已集成到首页导航栏和主要功能区，admin/manager可随时访问。

## 权限体系
- **admin**：超级管理员，管理所有用户、学生、课消记录、排课，查看所有操作日志，拥有全部权限
- **manager**：管理者，仅能管理 user、学生、课消记录、自己排的课，仅能编辑/消课自己排的课，不能删除排课，不能操作 admin/manager
- **user**：普通用户，仅能查看与自己相关的数据

## 移动端适配与横屏优化
- **横屏体验**：所有页面已适配移动端横屏，竖屏时自动弹出遮罩提示
- **横屏下字体、按钮、表格自适应**，内容显示更舒适
- **表格横向滚动**，数据多时也能流畅浏览

## 视觉与交互升级（2024年6月）
- **全站深色/浅色主题切换**：右上角一键切换，自动记忆，适配所有页面和内容区。
- **全站极简现代美化**：所有页面、卡片、表格、表单、按钮等风格统一，主色高亮，主次分明，极简现代。
- **FontAwesome 图标全覆盖**：所有主要按钮、菜单、表头、表单等批量加上合适图标，提升辨识度和美观度。
- **按钮主次分明**：主按钮主色填充，次按钮描边，禁用按钮灰色，删除按钮红色，hover高亮，全部小巧圆角。
- **全站背景图**：登录页和内容区分别有独立背景图，内容区卡片/表格/表单等半透明通透，深色模式下自动加深。
- **登录页美化**：全屏背景图片+半透明卡片+绿色描边输入框+图标，极简现代，登录失败有红色提示。
- **排课表字段升级**：已合并为 `start_datetime` 和 `end_datetime`，所有前后端表单、数据库、页面展示已适配。

## 一键初始化脚本
如需**清空所有业务数据并重置admin账号**，可运行：
```bash
python clear_db.py
```
- 所有用户、学生、课程、课消记录、排课、操作日志等数据将被清空。
- 所有自增ID将重置。
- 仅保留admin账号，密码为888888。

## 环境依赖
- Python 3.7+
- Flask
- pypinyin

安装依赖：
```bash
pip install -r requirements.txt
```
如无 requirements.txt，可手动安装：
```bash
pip install flask pypinyin
```

## 数据库升级说明
- 排课表已支持 `start_date`、`end_date` 字段，精确到分钟。
- 老的 `date` 字段已移除。
- 如遇数据库结构不符，请运行升级脚本或联系开发者。

## 部署与开发
1. 克隆项目
   ```bash
   git clone <your-repo-url>
   cd <project-folder>
   ```
2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```
3. 初始化数据库
   ```bash
   python init_db.py
   ```
4. 启动服务
   ```bash
   python app.py
   # 或 flask run
   ```
5. 浏览器访问
   - 本地：`http://127.0.0.1:5000`
   - 云端：部署平台分配的地址

## 常见问题
- **依赖未安装**：请用 pip 安装缺失的库。
- **database is locked**：请关闭所有占用数据库的程序或重启电脑。
- **路径问题**：建议项目路径全英文，避免中文或特殊字符。
- **推送失败**：请检查网络、VPN、代理设置，或先 pull 再 push
- **数据库初始化/重置**：运行 `init_db.py` 或相关脚本
- **移动端显示异常**：请刷新浏览器缓存，或切换横屏

## 贡献与协作
- 推荐使用 GitHub 协作开发，推送前请先 `git pull` 保持同步
- 如遇冲突，手动解决后再 push
- 已内置3个学生测试账号（张三、李四、王五），便于初始体验和测试。

---
如有更多问题或建议，欢迎 issue 或联系开发者。
